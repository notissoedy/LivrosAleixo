<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="livroTitulo1">Nome do Livro | Fx-Book</title>
  <meta name="description"
    content="Veja detalhes completos sobre o livro Nome do Livro, incluindo autor, ano, preço, formato e muito mais.">
  <meta name="keywords" content="livro, autor, ISBN, formato, descrição, comprar, Fx-Book">
  <meta name="author" content="Fx-Book">
  <link rel="stylesheet" href="css/style.css">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    .book-details {
      margin-top: 3rem;
    }

    .book-cover {
      max-width: 100%;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }

    .tags span {
      margin: 0.25rem;
    }

    .star-rating i {
      color: #f5c518;
    }

    .description {
      margin-top: 2rem;
      font-size: 1.1rem;
      line-height: 1.6;
      margin: 0.25rem;
    }
  </style>
  <script type="text/javascript" src="https://payhip.com/payhip.js"></script>
  <script type="text/javascript" src="js/script.js"></script>

</head>

<body>

  <!-- login form  -->
  <div class="login-form-container">
    <div id="close-login-btn" class="fas fa-times"></div>

    <form onsubmit="login(event)">
      <h3>Sign in</h3>
      <span>Email</span>
      <input id="loginEmail" type="email" class="box" placeholder="Enter your email" required>
      <span>Password</span>
      <input id="loginPassword" type="password" class="box" placeholder="Enter your password" required>
      <div class="checkbox">
        <input type="checkbox" id="remember-me">
        <label for="remember-me">Remember me</label>
      </div>
      <input type="submit" value="Sign in" class="btn">
      <p>Forget password? <a href="#" onclick="forgotPassword()">Click here</a></p>
      <p>Don't have an account? <a href="#" onclick="showSignup()">Create one</a></p>
    </form>
  </div>


  <!-- signup form  -->

  <div class="login-form-container signup-form-container">
    <div id="close-signup-btn" class="fas fa-times"></div>

    <form onsubmit="signup(event)">
      <h3>sign up</h3>
      <span>Email</span>
      <input id="signupEmail" type="email" class="box" placeholder="enter your email" required>
      <span>Password</span>
      <input id="signupPassword" type="password" class="box" placeholder="enter your password" required>
      <div class="checkbox">
        <input type="checkbox" id="remember-me">
        <label for="remember-me"> remember me</label>
      </div>
      <input type="submit" value="sign up" class="btn">
      <p>have an account? <a href="#" onclick="showLogin()">login</a></p>
    </form>
  </div>


  <section class="section">
    <div class=" book-details header">
      <div class="columns is-variable is-12 is-flex-direction-column-mobile">
        <!-- Capa -->
        <div class="column is-4">
          <figure class="image is-3by4">
            <img id="livroCapa" class="book-cover" src="https://via.placeholder.com/300x400" alt="Capa do livro">
          </figure>
        </div>

        <!-- Detalhes -->
        <div class="column is-3">
          <h1 class="title" id="livroTitulo">Título do Livro</h1>
          <div id="star" class="star-rating mb-3">
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star-half-alt"></i>
            <i class="far fa-star"></i>
          </div>

          <p><strong><i class="fas fa-user"></i> Autor:</strong> <span id="autor">Desconhecido</span></p>
          <p><strong><i class="fas fa-building"></i> Publisher:</strong> <span id="editora">Editora Exemplo</span></p>
          <p><strong><i class="fas fa-calendar-alt"></i> Ano:</strong> <span id="ano">2023</span></p>
          <p><strong><i class="fas fa-book"></i> Formato:</strong> <span id="formato">Físico</span></p>
          <p><strong><i class="fas fa-building"></i> Tamanho:</strong> <span id="tamanho">56Mb</span></p>
          <p><strong><i class="fas fa-language"></i> Idioma:</strong> <span id="idioma">Português</span></p>
          <p><strong><i class="fas fa-barcode"></i> ISBN:</strong> <span id="isbn">123-456-789</span></p>
          <p id="youtube" style="display: none;"><strong><i class="fas fa-video"></i> Video:</strong> <span><a>Ver no
                Youtube</a></span></p>
          <div id="precoContainer" class="mt-4">
            <p id="preco" class="is-size-4 has-text-weight-semibold has-text-danger">$19.99 <span
                class="is-size-5 has-text-grey-light has-text-line-through ml-2">$29.99</span></p>
          </div>

          <div class="mt-3">
            <strong><i class="fas fa-tags"></i> Tags:</strong>
            <div id="tags" class="tags">


            </div>
          </div>
          <div id="divComprar">
            <a id="payhip" href="" class=" is-primary mt-4 payhip-buy-button" data-theme="green" data-product=""><i
                class="fas fa-cart-plus mr-2"></i> Comprar Agora</a>
            <a id="loginbtn" onclick="showLogin()" style="display: none;" class="button is-primary mt-4"><i
                class="fas fa-cart-plus mr-2"></i> Comprar Agora</a>

          </div>





          <!-- <a href="https://payhip.com/b/8io2e" class="payhip-buy-button" data-theme="green" data-product="8io2e">Buy Now</a> -->

        </div>

        <div class=" column is-5 description ">
          <h2 class="title is-4">Descrição do Livro</h2>
          <p id="livroDescricao">
            Este livro aborda estratégias modernas de marketing digital com uma abordagem prática e acessível. Ideal
            para iniciantes e profissionais que desejam atualizar seus conhecimentos. Com estudos de caso e dicas
            aplicáveis ao mercado moçambicano e global.
          </p>
        </div>
      </div>
    </div>
    </div>
  </section>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      sendPasswordResetEmail, onAuthStateChanged, createUserWithEmailAndPassword
    }
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBHcbcRZ98WOHEQu9t2qnjLHP9Wvz_ggPs",
      authDomain: "aleixobook.firebaseapp.com",
      projectId: "aleixobook",
      storageBucket: "aleixobook.firebasestorage.app",
      messagingSenderId: "989202118697",
      appId: "1:989202118697:web:508c40a7acfbbf80dcc438",
      measurementId: "G-SXD8VPN6HK"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    const categoria = params.get("categoria");

    if (!id || !categoria) {
      alert("Livro não encontrado.");
    } else {
      const docRef = doc(db, `livros-${categoria}`, id);
      getDoc(docRef).then((docSnap) => {
        if (docSnap.exists()) {
          const livro = docSnap.data();
          document.getElementById("livroCapa").src = livro.capa;
          document.getElementById("livroTitulo").textContent = livro.titulo;
          document.getElementById("livroTitulo1").textContent = livro.titulo;

          document.getElementById("livroDescricao").textContent = livro.descricao;
          // document.getElementById("livroUrl").href = livro.url;

          document.getElementById("autor").textContent = livro.autor;
          document.getElementById("editora").textContent = livro.editora;
          document.getElementById("ano").textContent = livro.ano;
          document.getElementById("formato").textContent = livro.formato;
          document.getElementById("tamanho").textContent = livro.tamanho;
          document.getElementById("idioma").textContent = livro.idioma;
          document.getElementById("isbn").textContent = livro.isbn;

          const precoContainer = document.getElementById("precoContainer");

          precoContainer.innerHTML = "";
          const preco = document.createElement("p");
          preco.className = "is-size-4 has-text-weight-semibold has-text-danger";
          preco.innerHTML = `${livro.preco}MT <span class="is-size-5 has-text-grey-light has-text-line-through ml-2">${livro.novoPreco}MT</span>`;
          precoContainer.appendChild(preco);



          const tags = livro.tags;
          const tagArray = tags.split(',');

          const colors = ["is-info", "is-success", "is-warning", "is-primary", "is-danger"];
          const tagsContainer = document.getElementById("tags");

          tagArray.forEach((tag, index) => {
            const span = document.createElement("span");
            span.className = `tag ${colors[index % colors.length]}`;
            span.textContent = tag.trim();
            tagsContainer.appendChild(span);
          });



          const star = document.getElementById("star");
          star.innerHTML = ` ${"<i class='fas fa-star'></i>".repeat(livro.estrelas || 0)}
                                <i class="fas fa-star-half-alt"></i>`;

          const divComprar = document.getElementById("divComprar");

          if (livro.video) {
            const youtube = document.getElementById("youtube");
            youtube.style.display = "inline-block";
            youtube.innerHTML = `<strong><i class="fas fa-video"></i> Video:</strong> <span ><a  href="${livro.video}" target="_blank">Ver no Youtube</a></span>`;
          }

          // Verifica se o URL contém 'payhip.com/b/'
          if (livro.url && livro.url.includes("payhip.com/b/")) {
            // Extrai o ID do produto do final da URL
            const payhipProductId = livro.url.split("/b/")[1];


            const payhip = document.getElementById("payhip");


            payhip.href = livro.url;
            payhip.setAttribute("data-product", payhipProductId);


          } else {
            // Caso não seja Payhip, exibe o botão tradicional (opcional)
            divComprar.innerHTML = `
              <a href="${livro.url}" target="_blank" class="button is-primary is-medium  mt-4 ">
                <i class="fas fa-cart-plus mr-2"></i> Amazon 
              </a>
               
            `;
          }

        } else {
          alert("Livro não encontrado.");
        }
      }).catch((error) => {
        console.error("Erro ao buscar livro:", error);
        alert("Erro ao carregar livro.");
      });


    }

    // Função de cadastro
    const signup = async function (event) {
      event.preventDefault();

      const email = document.getElementById("signupEmail").value;
      const password = document.getElementById("signupPassword").value;

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        // Salvar info adicional no Firestore
        await setDoc(doc(db, "usuarios", user.uid), {
          email: email,
          dataRegistro: serverTimestamp(),
          livrosComprados: [],
          favoritos: []
        });

        alert("Cadastro realizado com sucesso!");
        // Redirecionar ou fechar formulário
      } catch (error) {
        console.error("Erro no cadastro:", error.message);
        alert("Erro: " + error.message);
      }
    };

    window.signup = signup;

    // 🔐 Função de login
    const login = async (event) => {
      event.preventDefault(); // evita recarregar página

      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value;

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        alert("Login realizado com sucesso!");
        // Redirecionar ou esconder login-form
        document.querySelector(".login-form-container").classList.remove("active");

      } catch (error) {
        console.error(error);
        alert("Erro no login: " + error.message);
      }
    };
    window.login = login;
    // 🔐 Recuperação de senha
    const forgotPassword = async () => {
      const email = prompt("Digite seu email para recuperar a senha:");
      if (!email) return;

      try {
        await sendPasswordResetEmail(auth, email);
        alert("Link de recuperação enviado para seu email!");
      } catch (error) {
        alert("Erro ao enviar email: " + error.message);
      }
    };

    window.forgotPassword = forgotPassword;

    const logOut = async () => {
      signOut(auth).then(() => {
        alert("Você saiu da conta.");
      }).catch((error) => {
        console.error("Erro ao sair:", error);
      });
    };

    window.logOut = logOut;



    // Exibe o formulário de cadastro
    const showSignup = () => {
      document.querySelector('.login-form-container').classList.remove('active');
      document.querySelector('.signup-form-container').classList.add('active');
    };

    window.showSignup = showSignup;

    // Exibe o formulário de cadastro
    const showLogin = () => {
      document.querySelector('.login-form-container').classList.add('active');
      document.querySelector('.signup-form-container').classList.remove('active');

    };

    window.showLogin = showLogin;

    const payhip = document.getElementById("payhip");
    const loginbtn = document.getElementById("loginbtn");

    const auth = getAuth();
    onAuthStateChanged(auth, async (user) => {
      if (user) {
   
        payhip.style.display = "inline-block";
        //payhip.className=" is-primary mt-4 payhip-buy-button";
        loginbtn.style.display = "none";
      } else {
        payhip.style.display = "none";
        payhip.className = "";
        loginbtn.style.display = "inline-block";

       
      }
    });
  </script>




</body>

</html>