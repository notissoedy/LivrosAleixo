<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blog - Fx-Book</title>
  <meta name="description" content="Explore artigos incrÃ­veis sobre livros, educaÃ§Ã£o, leitura e desenvolvimento pessoal no blog Fx-Book." />
  <meta name="keywords" content="blog, livros, leitura, desenvolvimento pessoal, educaÃ§Ã£o, fx-book">
  <meta name="author" content="Fx-Book">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <style>
    body {
      background-color: #f5f5f5;
    }
    .blog-post img {
      max-width: 100%;
      border-radius: 8px;
    }
    .image-preview {
      max-height: 350px;
      object-fit: cover;
      width: 100%;
    }
    .search-bar {
      margin-bottom: 2rem;
    }
  </style>
</head>
<body>
  <nav class="navbar is-light" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="index.html">ðŸ“š <strong>Fx-Book</strong></a>
    </div>
  </nav>

  <section class="section">
    <div class="container">
      <h1 class="title is-3">Blog Fx-Book</h1>

      <div class="field has-addons search-bar">
        <div class="control is-expanded">
          <input id="searchInput" class="input" type="text" placeholder="Buscar por tÃ­tulo, categoria ou palavra-chave...">
        </div>
        <div class="control">
          <button id="searchBtn" class="button is-link">Buscar</button>
        </div>
      </div>

      <h2 class="title is-4">Artigo em destaque</h2>
      <div id="artigoPrincipal" class="box blog-post"></div>

      <h2 class="title is-4 mt-6">Artigos relacionados</h2>
      <div id="artigosRelacionados" class="columns is-multiline"></div>
    </div>
  </section>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBHcbcRZ98WOHEQu9t2qnjLHP9Wvz_ggPs",
      authDomain: "aleixobook.firebaseapp.com",
      projectId: "aleixobook",
      storageBucket: "aleixobook.appspot.com",
      messagingSenderId: "989202118697",
      appId: "1:989202118697:web:508c40a7acfbbf80dcc438"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let allPosts = [];

    async function carregarPosts(filtro = "") {
      const snap = await getDocs(collection(db, "blog-posts"));
      allPosts = [];
      snap.forEach(doc => allPosts.push({ id: doc.id, ...doc.data() }));
      allPosts.sort((a, b) => new Date(b.data) - new Date(a.data));

      const postsFiltrados = allPosts.filter(post => {
        const termo = filtro.toLowerCase();
        return (
          post.titulo.toLowerCase().includes(termo) ||
          post.categoria.toLowerCase().includes(termo) ||
          post.palavrasChave.toLowerCase().includes(termo)
        );
      });

      renderizarPosts(postsFiltrados);
    }

    function slugify(str) {
      return str.toLowerCase()
        .normalize('NFD').replace(/\p{Diacritic}/gu, '')
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-+|-+$/g, '');
    }

    function renderizarPosts(posts) {
      const principal = posts[0];
      const containerPrincipal = document.getElementById("artigoPrincipal");
      const containerRelacionados = document.getElementById("artigosRelacionados");

      containerPrincipal.innerHTML = principal ? `
        <article>
          <h2 class="title is-4">${principal.titulo}</h2>
          <figure>
            <img src="${principal.imagem}" alt="Imagem de capa" class="image-preview">
            <figcaption class="has-text-grey">${principal.legenda}</figcaption>
          </figure>
          <p class="is-size-7"><strong>Categoria:</strong> ${principal.categoria}</p>
          <p class="is-size-7"><strong>Palavras-chave:</strong> ${principal.palavrasChave}</p>
          <div class="mt-2">${principal.conteudo.slice(0, 300)}...</div>
          <a class="button is-link is-small mt-3" href="post.html?id=${principal.id}&titulo=${slugify(principal.titulo)}">Ler mais</a>
        </article>` : '<p>Nenhum post encontrado.</p>';

      containerRelacionados.innerHTML = "";
      posts.slice(1, 5).forEach(post => {
        const col = document.createElement("div");
        col.className = "column is-6-tablet is-4-desktop";
        col.innerHTML = `
          <div class="box">
            <h3 class="title is-6">${post.titulo}</h3>
            <figure>
              <img src="${post.imagem}" alt="Imagem relacionada" class="image-preview">
            </figure>
            <p class="is-size-7 has-text-grey">${post.legenda}</p>
            <p class="is-size-7">Categoria: ${post.categoria}</p>
            <a href="post.html?id=${post.id}&titulo=${slugify(post.titulo)}" class="button is-small is-link mt-2">Ver detalhes</a>
          </div>
        `;
        containerRelacionados.appendChild(col);
      });
    }

    document.getElementById("searchBtn").onclick = () => {
      const termo = document.getElementById("searchInput").value;
      carregarPosts(termo);
    };

    document.getElementById("searchInput").addEventListener("keypress", e => {
      if (e.key === "Enter") {
        e.preventDefault();
        document.getElementById("searchBtn").click();
      }
    });

    carregarPosts();
  </script>
</body>
</html>
